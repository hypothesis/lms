{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "LMS Gateway to H return schema",

    "examples": [
        {
            "api": {
                "h": {
                    "list_endpoints": {
                        "method": "GET",
                        "url": "https://h.example.com/api",
                        "headers": {
                            "Accept": "application/vnd.hypothesis.v2+json"
                        }
                    },
                    "exchange_grant_token": {
                        "method": "POST",
                        "url": "https://h.example.com/api/token",
                        "headers": {
                            "Accept": "application/vnd.hypothesis.v2+json",
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        "data": {
                            "assertion": "abcdef0123456789",
                            "grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"
                        }
                    }
                }
            },
            "data": {
                "assignments": [
                    {
                        "lms": {
                            "document_url": "https://example.com"
                        },
                        "lti": {
                            "resource_link_id": "23987234",
                            "resource_link_title": "Assignment name",
                            "resource_link_description": "Assignment description"
                        }
                    }
                ]
            }
        }
    ],

    "type": "object",
    "properties": {
        "api": {
            "properties": {
                "h": {
                    "description": "Pre-defined calls to H API end-points",
                    "type": "object",
                    "properties": {
                        "list_endpoints": {
                            "description": "List all end-points in the H API",
                            "$ref": "#/$defs/api_call"
                        },
                        "exchange_grant_token": {
                            "description": "Exchange grant token for access and refresh tokens",
                            "$ref": "#/$defs/api_call"
                        }
                    },
                    "additionalProperties": false,
                    "required": ["list_endpoints", "exchange_grant_token"]
                }
            },
            "required": ["h"]
        },
        "data": {
            "type": "object",
            "properties": {
                "assignments": {
                    "type": "array",
                    "items": {"$ref": "#/$defs/assignment"}
                }
            },
            "required": ["assignments"],
            "additionalProperties": false
        }
    },
    "required": ["api", "data"],
    "additionalProperties": false,

    "$defs": {
        "assignment": {
            "type": "object",
            "properties": {
                "lms": {
                    "type": "object",
                    "properties": {
                        "document_url": {"type":  "string"}
                    },
                    "additionalProperties": false,
                    "required": ["document_url"]
                },
                "lti": {
                    "type": "object",
                    "properties": {
                        "resource_link_id": {"type":  "string"},
                        "resource_link_title": {"type":  "string"},
                        "resource_link_description": {"type":  "string"}
                    },
                    "additionalProperties": false,
                    "required": [
                        "resource_link_id",
                        "resource_link_title",
                        "resource_link_description"
                    ]
                }
            },
            "additionalProperties": false,
            "required": ["lms", "lti"]
        },
        "api_call": {
            "title": "Pre-defined API call",
            "type": "object",

            "properties": {
                "method": {"type": "string", "enum": ["GET", "POST"]},
                "url": {"type":  "string", "format": "uri"},
                "headers": {"type":  "object"},
                "data": {"type":  "object"}
            },
            "additionalProperties": false,
            "required": ["method", "url"]
        }
    }
}